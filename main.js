(()=>{"use strict";var e,t={888:(e,t,n)=>{var i=n(212),s=n(886),r=n(219);class a extends class{constructor(){this.xr=!window.location.search.includes("debug")}}{constructor(e){super(),this._onSelect=e.onSelect||function(){},this.reticleMesh=e.reticleMesh||null,this.hitTestSource=null,this.hitTestSourceRequested=!1;const t=document.createElement("div");document.body.appendChild(t),this.camera=new i.cPb(45,window.innerWidth/window.innerHeight,.25,20),this.camera.position.set(-1.8,.6,2.7),this.scene=new i.xsS,this.clock=new i.SUY;const n=new i.Ox3(16777215,1);if(n.position.set(1e3,1e3,.25),this.scene.add(n),this.scene.add(new i.Mig(16777215)),!this.xr){const e=new i.y8_(5);this.scene.add(e);const t=10,n=10,s=new i.VLJ(t,n);this.scene.add(s),this.stats=new r.Z,document.body.appendChild(this.stats.dom)}if(this.renderer=new i.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.xr&&(this.renderer.xr.enabled=!0),t.appendChild(this.renderer.domElement),this.xr){document.body.appendChild(class{static createButton(e,t={}){const n=document.createElement("button");function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,n.textContent="不支持该设备哦"}function s(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="ARButton",n.style.display="none",s(n),navigator.xr.isSessionSupported("immersive-ar").then((function(s){s?function(){if(void 0===t.domOverlay){const e=document.createElement("div");e.style.display="none",document.body.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width",38),n.setAttribute("height",38),n.style.position="absolute",n.style.right="20px",n.style.top="20px",n.addEventListener("click",(function(){i.end()})),e.appendChild(n);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),s.setAttribute("stroke","#fff"),s.setAttribute("stroke-width",2),n.appendChild(s),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:e}}let i=null;async function s(s){s.addEventListener("end",r),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(s),n.textContent="停止AR",t.domOverlay.root.style.display="",i=s}function r(){i.removeEventListener("end",r),n.textContent="开启快乐之旅",t.domOverlay.root.style.display="none",i=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="开启快乐之旅",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){null===i?navigator.xr.requestSession("immersive-ar",t).then(s):i.end()}}():i()})).catch(i),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",s(e),e}}}.createButton(this.renderer,{requiredFeatures:["hit-test"]}));const e=this.renderer.xr.getController(0);e.addEventListener("select",(()=>{this.reticle.visible&&this._onSelect&&this._onSelect()})),this.scene.add(e),this.reticle=this.reticleMesh,this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.scene.add(this.reticle)}else{const e=new s.z(this.camera,this.renderer.domElement);e.minDistance=2,e.maxDistance=10,e.target.set(0,0,-.2),e.update()}window.addEventListener("resize",this.onWindowResize.bind(this)),this.renderer.setAnimationLoop(((t,n)=>{e.animationLoop&&e.animationLoop(),this.stats&&this.stats.update(),this.render.call(this,t,n)}))}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}render(e,t){if(this.xr&&t){const e=this.renderer.xr.getReferenceSpace(),n=this.renderer.xr.getSession();if(!1===this.hitTestSourceRequested&&(n.requestReferenceSpace("viewer").then((e=>{n.requestHitTestSource({space:e}).then((e=>{this.hitTestSource=e}))})),n.addEventListener("end",(()=>{this.hitTestSourceRequested=!1,this.hitTestSource=null})),this.hitTestSourceRequested=!0),this.hitTestSource){const n=t.getHitTestResults(this.hitTestSource);if(n.length){const t=n[0];this.reticle.visible=!0,this.reticle.matrix.fromArray(t.getPose(e).transform.matrix)}else this.reticle.visible=!1}}this.renderer&&this.renderer.render(this.scene,this.camera)}}const o=document.createElement("div");o.style.cssText="\ndisplay: flex;\nalign-items: center;\nheight: 100vh;\njustify-content: center;\n";const l=new i.lLk;l.onStart=function(e,t,n){document.body.appendChild(o),o.textContent="加载文件: "+e+".\n已加载 "+t+"个 总文件 "+n+" 个."},l.onLoad=function(){o.textContent="Loading complete!",document.body.removeChild(o)},l.onProgress=function(e,t,n){o.textContent="加载文件: "+e+".\n已加载 "+t+"个 总文件 "+n+" 个."},l.onError=function(e){o.textContent="There was an error loading "+e};const c={reticleMesh:{url:"./static/module/gltf/reticle/reticle.gltf",type:"gltf"},roseMesh:{url:"./static/module/gltf/rose/scene.gltf",type:"gltf"},heartMesh:{url:"./static/module/heart.gltf",type:"gltf"},fontMesh:{url:"./static/fonts/Dotted Songti Square_Regular.typeface.json",type:"font"},sprite1:{url:"./static/textures/rose.png",type:"texture"}},d=new(n(47).E)(l),h=new i.JfN(l),u=new i.dpR(l),p=class{constructor(e){this.env=e.env}onSelect(){}animationLoop(){}destroy(){}};class m extends p{onSelect(){const e=this.env,t=new i.vBJ({color:26265,transparent:!0,opacity:1,side:i.ehD}),n={font:c.fontMesh,size:.1,height:.02},s=new i.MP$("爱你宝贝",n);s.computeBoundingBox();const r=-.5*(s.boundingBox.max.x-s.boundingBox.min.x);s.translate(r,0,0);const a=new i.Kj0(s,t);e.reticle&&a.position.setFromMatrixPosition(e.reticle.matrix),a.position.y+=1,e.scene.add(a)}}const f=(e=0,t=0)=>Math.floor(Math.random()*(e+1-t))+t,y=(()=>{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=12.8,e.height=12.8,((e,t,n,i)=>{e.save();const s=e.createRadialGradient(t,t,0,t,t,t);s.addColorStop(0,"rgba(255,255,255,1.0)"),s.addColorStop(.5,"rgba(255,255,255,0.5)"),s.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=s,e.fillRect(0,0,n,i),e.restore()})(t,6.4,e.width,e.height);const n=new i.xEZ(e);return n.type=i.VzW,n.needsUpdate=!0,n})(),g=e=>{const t=3*e;return{x:t,y:t+1,z:t+2}},x=e=>{const t=4*e;return{r:t,g:t+1,b:t+2,a:t+3}},v=.998;class w{constructor(e,t,n){this.particleNum=e,this.timerStartFading=10,this.mesh=((e,t,n)=>{const s=new i.u9r,r=[],a=[],o=[],l=[],c=[],d=Math.random()>.3?"single":"multiple",h=.01*f(100,20),u=()=>.01*f(100,1);let p;const m=Math.random();p=m>.66?"red":m>.33?"green":"blue";for(let s=0;s<e;s++){const e=new i.Pa4(0,0,0);if(r.push(e.x,e.y,e.z),a.push(t[s].x,t[s].y,t[s].z),"seed"===n){let e;e=.1*Math.random()+.1,0===s&&(e*=1.1),l.push(e),c.push(.017*e),o.push(1,1,1,1)}else{const e=.001*f(10,10);if(l.push(.5),c.push(.017*e),"multiple"===d)o.push(u(),u(),u(),1);else switch(p){case"red":o.push(h,.1,.1,1);break;case"green":o.push(.1,h,.1,1);break;case"blue":o.push(.1,.1,h,1);break;default:o.push(h,.1,.1,1)}}}s.setAttribute("position",new i.a$l(r,3).setUsage(i.dj0)),s.setAttribute("velocity",new i.a$l(a,3).setUsage(i.dj0)),s.setAttribute("color",new i.a$l(o,4).setUsage(i.dj0)),s.setAttribute("adjustSize",new i.a$l(l,1).setUsage(i.dj0)),s.setAttribute("mass",new i.a$l(c,1).setUsage(i.dj0));const g=new i.FIo({uniforms:{size:{type:"f",value:12.8},texture:{type:"t",value:y}},transparent:!0,depthWrite:!1,blending:i.WMw,vertexShader:"precision mediump float;\n    attribute vec3 position;\n    uniform mat4 projectionMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform float size;\n    attribute float adjustSize;\n    uniform vec3 cameraPosition;\n    varying float distanceCamera;\n    attribute vec3 velocity;\n    attribute vec4 color;\n    varying vec4 vColor;\n    void main() {\n        vColor = color;\n        vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n        gl_PointSize = size * adjustSize ;\n        gl_Position = projectionMatrix * modelViewPosition;\n    }",fragmentShader:"precision mediump float;\n    uniform sampler2D texture;\n    varying vec4 vColor;\n    void main() {\n        vec4 color = vec4(texture2D(texture, gl_PointCoord));\n        gl_FragColor = color * vColor;\n    }"});return new i.woe(s,g)})(e,t,n)}update(e){this.timerStartFading>0&&(this.timerStartFading-=.3);const{position:t,velocity:n,color:i,mass:s}=this.mesh.geometry.attributes;for(let a=0;a<this.particleNum;a++){const{x:o,y:l,z:c}=g(a);n.array[l]+=e.y-s.array[a],n.array[o]*=v,n.array[c]*=v,n.array[l]*=v,t.array[o]+=n.array[o],t.array[l]+=n.array[l],t.array[c]+=n.array[c];const{a:d}=x(a);this.timerStartFading<=0&&(i.array[d]*=(Math.random()>.5?.98:.96)-(r=i.array[d],Math.random()>.5?0:.1*(1-r)),i.array[d]<.001&&(i.array[d]=0))}var r;t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}disposeAll(){this.mesh.geometry.dispose(),this.mesh.material.dispose()}}class _ extends w{constructor(e,t){super(e,t,"seed")}update(e){const{position:t,velocity:n,color:i,mass:s}=this.mesh.geometry.attributes,r=()=>Math.random()>.5?.05:-.05,a=()=>Math.random()>.1,o=.97804;for(let c=0;c<this.particleNum;c++){const{x:d,y:h,z:u}=g(c);n.array[h]+=e.y-s.array[c],n.array[d]*=o,n.array[u]*=o,n.array[h]*=o,t.array[d]+=n.array[d],t.array[h]+=n.array[h],t.array[u]+=n.array[u],a()&&(t.array[d]+=r()),a()&&(t.array[u]+=r());const{a:p}=x(c);i.array[p]*=(Math.random()>.3?.99:.96)-(l=i.array[p],Math.random()>.3?0:.1*(1-l)),i.array[p]<.001&&(i.array[p]=0)}var l;t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}}class M extends w{constructor(e,t){super(e,t,"trail")}update(e){const{position:t,velocity:n,color:i,mass:s}=this.mesh.geometry.attributes,r=()=>Math.random()>.5?.05:-.05,a=()=>Math.random()>.2;for(let o=0;o<this.particleNum;o++){const{x:l,y:c,z:d}=g(o);n.array[c]+=e.y-s.array[o],n.array[l]*=v,n.array[d]*=v,n.array[c]*=v,t.array[l]+=n.array[l],t.array[c]+=n.array[c],t.array[d]+=n.array[d],a()&&(t.array[l]+=r()),a()&&(t.array[d]+=r());const{a:h}=x(o);i.array[h]*=Math.random()>.3?.98:.95,i.array[h]<.001&&(i.array[h]=0)}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}}class b extends class{constructor(){this.meshGroup=new i.ZAu,this.isExplode=!1,this.petalsNum=f(400,150),this.life=150,this.seed=this.getSeed(),this.meshGroup.add(this.seed.mesh),this.flowerSizeRate=i.ZX$.mapLinear(this.petalsNum,150,400,.4,.7)}getSeed(){const e=[];for(let t=0;t<4;t++){const n=0,s=0===t?2.5*Math.random()+.9:2*Math.random()+.4,r=0;e.push(new i.Pa4(n,s,r))}const t=new _(4,e);return t.mesh.position.set(0,0,0),t}explode(e){this.isExplode=!0,this.flower=this.getFlower(e),this.meshGroup.add(this.flower.mesh),this.meshGroup.remove(this.seed.mesh),this.seed.disposeAll()}getFlower(e){const t=this.petalsNum,n=[];let s;if(Math.random()>.5)for(let e=0;e<t;e++){s=.01*f(120,60);const e=i.ZX$.degToRad(180*Math.random()),t=i.ZX$.degToRad(360*Math.random()),r=Math.sin(e)*Math.cos(t)*s,a=Math.sin(e)*Math.sin(t)*s,o=Math.cos(e)*s,l=new i.Pa4(r,a,o);l.multiplyScalar(this.flowerSizeRate),n.push(l)}else{const e=180/t,r=360*(20*Math.random()+1)/t,a=r,o=r;s=.01*f(120,60);for(let r=0;r<t;r++){const t=Math.sin(i.ZX$.degToRad(e*r)),l=Math.cos(i.ZX$.degToRad(e*r))*s,c=Math.cos(i.ZX$.degToRad(a*r))*t*s,d=Math.sin(i.ZX$.degToRad(o*r))*t*s,h=new i.Pa4(c,d,l);h.multiplyScalar(this.flowerSizeRate),n.push(h)}}const r=new w(t,n);return r.mesh.position.set(e.x,e.y,e.z),r}update(e){this.isExplode?(this.flower.update(e),this.life>0&&(this.life-=1)):this.drawTail()}drawTail(){this.seed.update(new i.Pa4(0,-.005,0));const{position:e,velocity:t}=this.seed.mesh.geometry.attributes;let n=0,s=!0;for(let e=0,i=t.array.length;e<i;e++){const i=t.array[e];1==e%3&&i>0&&n++}if(s=0==n,!s)return;const{x:r,y:a,z:o}=this.seed.mesh.position,l=new i.Pa4(r,a,o);let c,d=0;for(let t=0,n=e.array.length;t<n;t++){const n=e.array[t];1==t%3&&n>d&&(d=n,c=new i.Pa4(e.array[t-1],n,e.array[t+2]))}l.add(c),this.explode(l)}}{constructor(){super(),this.petalsNum=f(100,50),this.flowerSizeRate=i.ZX$.mapLinear(this.petalsNum,50,100,1.4,1.7),this.tailMeshGroup=new i.ZAu,this.tails=[]}explode(e){this.isExplode=!0,this.flower=this.getFlower(e),this.tails=this.getTail(),this.meshGroup.add(this.flower.mesh),this.meshGroup.add(this.tailMeshGroup)}getTail(){const e=[],{color:t}=this.flower.mesh.geometry.attributes;for(let n=0;n<this.petalsNum;n++){const s=[];for(let e=0;e<20;e++){const e=0,t=0,n=0;s.push(new i.Pa4(e,t,n))}const r=new M(20,s),{r:a,g:o,b:l,a:c}=x(n),d=t.array[a],h=t.array[o],u=t.array[l],p=t.array[c],{position:m,color:f}=r.mesh.geometry.attributes;for(let e=0;e<m.count;e++){const{r:t,g:n,b:i,a:s}=x(e);f.array[t]=d,f.array[n]=h,f.array[i]=u,f.array[s]=p}const{x:y,y:g,z:v}=this.flower.mesh.position;r.mesh.position.set(y,g,v),e.push(r),this.tailMeshGroup.add(r.mesh)}return e}update(e){if(this.isExplode){this.flower.update(e);const{position:t}=this.flower.mesh.geometry.attributes;for(let n=0,s=this.tails.length;n<s;n++){const s=this.tails[n];s.update(e);const{x:r,y:a,z:o}=g(n),l=new i.Pa4(t.array[r],t.array[a],t.array[o]),{position:c,velocity:d}=s.mesh.geometry.attributes;for(let e=0;e<c.count;e++){const{x:t,y:n,z:s}=g(e),r=new i.Pa4,a=new i.Pa4(c.array[t],c.array[n],c.array[s]),o=new i.Pa4(d.array[t],d.array[n],d.array[s]);r.subVectors(l,a);const h=r.sub(o);h.normalize(),h.multiplyScalar(3e-4*Math.random()*this.life),d.array[t]+=h.x,d.array[n]+=h.y,d.array[s]+=h.z}d.needsUpdate=!0}this.life>0&&(this.life-=1.2)}else this.drawTail()}}class z extends p{constructor(e){super(e),this.fireworksInstances=[]}onSelect(){const e=this.env;this.timer=setInterval((()=>{this.addFireWorks(e)}),100)}animationLoop(){const e=this.env,t=[];for(let e=this.fireworksInstances.length-1;e>=0;e--){const n=this.fireworksInstances[e];n.update(new i.Pa4(0,-.005,0)),n.isExplode&&t.push(e)}for(let n=0,i=t.length;n<i;n++){const i=t[n],s=this.fireworksInstances[i];if(!s)return;s.meshGroup.remove(s.seed.mesh),s.seed.disposeAll(),s.life<=0&&(e.scene.remove(s.meshGroup),s.tailMeshGroup&&s.tails.forEach((e=>{e.disposeAll()})),s.flower.disposeAll(),this.fireworksInstances.splice(i,1))}}addFireWorks(){const e=this.env;for(let t=0;t<5-this.fireworksInstances.length;t++){const t=new b;this.fireworksInstances.push(t),t.meshGroup.scale.x=.01,t.meshGroup.scale.y=.01,t.meshGroup.scale.z=.01,t.meshGroup.position.x=e.last_xyz.x+.6*Math.random()-.3,t.meshGroup.position.y=e.last_xyz.y+.6*Math.random()-.3,t.meshGroup.position.z=e.last_xyz.z+.6*Math.random()-.3,e.scene.add(t.meshGroup)}}}class S extends p{constructor(e){super(e),this._particles=null}onSelect(){const e=this.env,t=new i.u9r,n=[],s=[];for(let e=0;e<100;e++){const e=6*Math.random()-3,t=6*Math.random()-3,i=6*Math.random()-3;n.push(e,t,i)}t.setAttribute("position",new i.a$l(n,3));const r=[[[.9,.05,.5],c.sprite1,.3]];for(let n=0;n<r.length;n++){const a=r[n][0],o=r[n][1],l=r[n][2];s[n]=new i.UY4({size:l,map:o,blending:i.WMw,depthTest:!1,transparent:!0}),s[n].color.setHSL(a[0],a[1],a[2]);const c=new i.woe(t,s[n]);c.rotation.x=6*Math.random(),c.rotation.y=6*Math.random(),c.rotation.z=6*Math.random(),this._particles=c,e.scene.add(c)}}animationLoop(){if(this._particles){const e=this._particles.geometry.attributes.position,t=e.count;for(let n=0;n<t;n++){const t=e.getX(n),s=e.getY(n),r=e.getZ(n),a=new i.FM8(t,r);a.rotateAround(new i.FM8(0,0),i.ZX$.degToRad(1)),e.setXYZ(n,a.x,s,a.y)}e.needsUpdate=!0}}}class P extends p{onSelect(){const e=this.env;e.reticle&&c.roseMesh.scene.position.setFromMatrixPosition(e.reticle.matrix);for(let t=-10;t<10;t++)for(let n=-10;n<10;n++){if(Math.pow(t,2)+Math.pow(n,2)>64)continue;const i=c.roseMesh.scene.clone();i.position.set(t/15+i.position.x,i.position.y,n/15+i.position.z);const s=.05*Math.random()+.1,r=360*Math.random();i.scale.set(s,s,s),i.rotation.set(0,r,0),e.scene.add(i)}}}const T={uniforms:i.rDY.merge([i.rBU.common,i.rBU.specularmap,i.rBU.envmap,i.rBU.aomap,i.rBU.lightmap,i.rBU.emissivemap,i.rBU.bumpmap,i.rBU.normalmap,i.rBU.displacementmap,i.rBU.fog,i.rBU.lights,{wrapRGB:{type:"v3",value:new i.Pa4(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif","#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>","uniform float time;","attribute vec3 center;","attribute float level;","void main() {","#include <uv_vertex>\n     #include <uv2_vertex>\n     #include <color_vertex>\n   \n     #include <beginnormal_vertex>\n     #include <morphnormal_vertex>\n     #include <skinbase_vertex>\n     #include <skinnormal_vertex>\n     #include <defaultnormal_vertex>","#ifndef FLAT_SHADED","vNormal = normalize( transformedNormal );","#endif","float timeRatio = 1.0 - smoothstep(0.0, 20.0, 0.5 * time - level);","#include <begin_vertex>\n      #include <morphtarget_vertex>\n      #include <skinning_vertex>\n      #include <displacementmap_vertex>\n      #include <project_vertex>","#ifdef USE_SKINNING","vec4 pPosition = vec4(mix(skinned.xyz, center, timeRatio), skinned.w);","mvPosition = modelViewMatrix * pPosition;","#elif defined( USE_MORPHTARGETS )","vec3 pPosition = mix(morphed, center, timeRatio);","mvPosition = modelViewMatrix * vec4( pPosition, 1.0 );","#else","vec3 pPosition = mix(position.xyz, center, timeRatio);","mvPosition = modelViewMatrix * vec4( pPosition, 1.0 );","#endif","\n     gl_Position = projectionMatrix * mvPosition;","\n      #include <logdepthbuf_vertex>\n      #include <clipping_planes_vertex>","vViewPosition = -mvPosition.xyz;","#include <worldpos_vertex>\n      #include <envmap_vertex>\n      #include <shadowmap_vertex>\n      #include <fog_vertex>","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","\n      #include <common>\n      #include <packing>\n      #include <dithering_pars_fragment>\n      #include <color_pars_fragment>\n      #include <uv_pars_fragment>\n      #include <uv2_pars_fragment>\n      #include <map_pars_fragment>\n      #include <alphamap_pars_fragment>\n      #include <aomap_pars_fragment>\n      #include <lightmap_pars_fragment>\n      #include <emissivemap_pars_fragment>\n      #include <envmap_common_pars_fragment>\n      #include <envmap_pars_fragment>\n      #include <cube_uv_reflection_fragment>\n      #include <fog_pars_fragment>\n      #include <bsdfs>\n      #include <lights_pars_begin>\n      #include <lights_phong_pars_fragment>\n      #include <shadowmap_pars_fragment>\n      #include <bumpmap_pars_fragment>\n      #include <normalmap_pars_fragment>\n      #include <specularmap_pars_fragment>\n      #include <logdepthbuf_pars_fragment>\n      #include <clipping_planes_pars_fragment>","void main() {","#include <clipping_planes_fragment>\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveRadiance = emissive;","vec4 diffuseColor = vec4( diffuse, opacity );","\n\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n\n// accumulation\n#include <lights_phong_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n\n// modulation\n#include <aomap_fragment>\n\n//vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\nvec3 outgoingLight = vec3( 0.0 ); // outgoing light does not have an alpha, the surface does\n#include <envmap_fragment>\n\n\n\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>","gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},A=T.vertexShader,E=T.fragmentShader;class L extends i.jyz{constructor(){super({uniforms:i.rDY.merge([T.uniforms,{emissive:{type:"c",value:new i.Ilk(0)},specular:{type:"c",value:new i.Ilk(0)},shininess:{type:"f",value:1},time:{type:"f",value:0}}]),attributes:{center:{type:"v3",value:null},level:{type:"f",value:null}},vertexShader:A,fragmentShader:E,shading:i.wcA,lights:!0})}}function R(e,t,n){this.set(e,t,n)}function k(e,t,n){this.oldPos=new R(e,t,n),this.pos=new R(e,t,n),this.vel=new R,this.radius=0,this.time=void 0,this.maxTime=void 0,this.oldIds=void 0,this.newIds=new Float32Array(4)}function F(e,t){this.branches=[],this.particles=[],this.separation=.001,this.friction=.99,this.minTime=5,this.maxTime=25,this.maxParticle=1e3,this.maxSpeed=5,this.radiusMin=1,this.randomness=.25,this.iteration=0;const n=[function(e){return.1*Math.pow(.4*e,2)},function(e){return.3*Math.pow(e,1.1)}];this.radiusFunc=n[Math.floor(Math.random()*n.length)],this.radiusFunc=n[1];const i=this.createFirstParticle(e,t);this.addParticle(i)}function B(e,t,n){if(e.x==t.x&&e.y==t.y)return{x:e.x,y:e.y};const i=t.x-e.x,s=t.y-e.y,r=((n.x-e.x)*i+(n.y-e.y)*s)/(i*i+s*s);return{x:r*i+e.x,y:r*s+e.y}}function C(e,t){this.treshold=e*e,this.lookAhead=t}function U(e,t){t=t||{};const n=1/function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}(e);return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}function G(e,t,n){return(n=n||{}).x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n}function j(e,t,n){return(n=n||{}).x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n}function N(e,t){return function(e,t,n){return(n=n||{}).x=-1*e.x,n.y=-1*e.y,n.z=-1*e.z,n}(e,0,t=t||{})}R.prototype={add:function(e,t,n){this.x+=e,this.y+=t,this.z+=n},addVec:function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},set:function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},setVec:function(e){this.x=e.x||0,this.y=e.y||0,this.z=e.z||0},scale:function(e){this.x*=e,this.y*=e,this.z*=e},getLength2:function(){return this.x*this.x+this.y*this.y+this.z*this.z},getLength:function(){return Math.sqrt(this.getLength2())},normalize:function(){const e=1/this.getLength();this.x*=e,this.y*=e,this.z*=e},setlength:function(e){this.normalize(),this.scale(e)}},R.getDiff=function(e,t,n){return n||(n=new R),n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n},k.prototype={update:function(){this.oldPos.setVec(this.pos),this.pos.addVec(this.vel)},resetTime:function(e,t){this.time=this.maxTime=Math.random()*(t-e)+e},draw:function(e){e.beginPath(),e.lineWidth=this.radius+(this.sizeSplit-this.radius)*(1-this.time/this.maxTime),e.strokeStyle="black",e.lineCap="round",e.moveTo(this.oldPos.x,this.oldPos.y),e.lineTo(this.pos.x,this.pos.y),e.stroke()}},F.prototype={createFirstParticle:function(e,t){const n=new k;return n.pos.x=e,n.pos.y=t,n.pos.z=0,n.vel.x=n.vel.z=0,n.vel.y=-this.maxSpeed,n.radius=50,n.sizeSplit=(.5+.5*Math.random())*n.radius,n.resetTime(this.minTime,this.maxTime),n},update:function(){const e=new R;let t=this.particles.length;for(let n=0;n<t;n++){const i=this.particles[n];i.radius*=.977;for(let s=n+1;s<t;s++){const t=this.particles[s];let n=R.getDiff(i.pos,t.pos,e);const r=n.getLength2(),a=i.radius+t.radius;if(r<a*a){const s=Math.sqrt(r),o=a/s;n=(a-s)*o;const l=t.radius/(t.radius+i.radius);e.scale(-l*this.separation*o),i.vel.addVec(e),e.scale(1-1/l),t.vel.addVec(e)}}e.x=2*Math.random()-1,e.y=2*Math.random()-1,e.z=2*Math.random()-1,e.setlength(this.randomness),i.vel.addVec(e),i.vel.scale(this.friction),i.vel.getLength2()>this.maxSpeed*this.maxSpeed&&i.vel.setlength(this.maxSpeed),i.update(),--i.time<=0&&(this.particles.length<this.maxParticle&&i.radius>this.radiusMin?this.splitParticle(i):(this.removeParticle(i),t--,n--)),this.branches[i.bid].push({x:i.pos.x,y:i.pos.y,z:i.pos.z,level:this.iteration,radius:this.radiusFunc(i.radius)})}this.iteration++},splitParticle:function(e){const t=new k(e.pos.x+.01*(2*Math.random()-1),e.pos.y,e.pos.z+.01*(2*Math.random()-1));t.radius=e.radius,e.sizeSplit=(.5+.5*Math.random())*e.radius,t.sizeSplit=(.5+.5*Math.random())*t.radius,t.vel.setVec(e.vel),this.addParticle(t),e.resetTime(this.minTime,this.maxTime),t.resetTime(this.minTime,this.maxTime)},addParticle:function(e){e.bid=this.branches.length,this.branches.push([]),e.pid=this.particles.length,this.particles.push(e)},removeParticle:function(e){const t=this.particles[this.particles.length-1];void 0!==t&&(t.pid=e.pid,this.particles[e.pid]=t),this.particles.length--}},C.prototype={apply:function(e){const t=[],n=e.length;let i;for(let s=0;s<n-1;s=i){t.push(e[s]),i=Math.min(s+this.lookAhead,n-1);let r=!1;for(;i>s+1&&!r;i--)for(let t=s+1;t<i&&!r;t++){const n=B(e[s],e[i],e[t]),a=n.x-e[t].x,o=n.y-e[t].y;r=a*a+o*o<this.treshold}}return t.push(e[n-1]),t}};const V=new L,O=new F(0,0);for(let e=0;e<200;e++)O.update();const I=new C(1,1),D=O.branches.map(I.apply.bind(I));D.forEach((function(e){e.forEach((function(e){}));const t=e[e.length-1];void 0!==t&&(t.radius=0)}));const $=function(e){function t(t){return e.reduce((function(e,n){return e+n.attributes[t].array.length}),0)}function n(n,r,a){const o=new r(t(n));e.reduce((function(e,t){const i=t.attributes[n].array,s=i.length;for(let t=0;t<s;t++)e.buffer[e.indexBegin+t]=i[t];return e.indexBegin+=s,e}),{indexBegin:0,buffer:o}),s.setAttribute(n,new i.TlE(o,a))}var s=new i.u9r;return n("position",Float32Array,3),n("center",Float32Array,3),n("level",Float32Array,1),function(){const n=new Uint32Array(t("index"));e.reduce((function(e,t){const n=t.attributes.index.array,i=n.length;for(let t=0;t<i;t++)e.buffer[e.indexBegin+t]=e.positionBegin+n[t];return e.indexBegin+=i,e.positionBegin+=t.attributes.position.array.length/3,e}),{indexBegin:0,positionBegin:0,buffer:n}),s.setIndex(new i.TlE(n,1))}(),n("uv",Float32Array,2),n("normal",Float32Array,3),s}(D.filter((function(e){return e.length>=2})).map((function(e){return function(e,t){const n=new i.u9r,s=function(e){const t=e.length,n=[],i=[],s=[],r=U(G(e[1],e[0]));var a,o;n[0]=r,i[0]=U((o=o||{},0===(a=r).x?(o.x=1,o.y=o.z=0):(o.x=-(a.y+a.z)/a.x,o.y=o.z=1),o)),s[0]=U(j(r,i[0]));for(var l=1;l<t-1;l++){const t=e[l-1],r=U(G(e[l+1],t));n[l]=r,i[l]=N(U(j(r,s[l-1]))),s[l]=U(j(r,i[l]))}const c=U(G(e[t-1],e[t-2]));return n[t-1]=c,i[t-1]=N(U(j(c,s[t-2]))),s[t-1]=U(j(c,i[l])),{tans:n,vas:i,vbs:s}}(e),r=function(e,t,n,i){const s=e.length,r=new Float32Array(s*i*3),a=new Float32Array(s*i*3),o=2*Math.PI/i;for(let l=0;l<s;l++){const s=e[l],c=t[l],d=n[l],h=l*i*3;for(let e=0;e<i;e++){const t=e*o,n=Math.cos(t),i=Math.sin(t),l=h+3*e;r[l]=s.x+s.radius*c.x*n+s.radius*d.x*i,r[l+1]=s.y+s.radius*c.y*n+s.radius*d.y*i,r[l+2]=s.z+s.radius*c.z*n+s.radius*d.z*i,a[l]=s.x,a[l+1]=s.y,a[l+2]=s.z}}return{positions:r,centers:a}}(e,s.vas,s.vbs,t),a=function(e,t){const n=e.length/3,i=new Uint16Array(6*(n-1));for(let e=0;e<n-t;e++){const n=6*e,s=(e+1)%t==0?e-(t-1):e+1;i[n]=e,i[n+1]=s+t,i[n+2]=s,i[n+3]=e,i[n+4]=e+t,i[n+5]=s+t}return i}(r.positions,t),o=function(e,t){const n=e.length/3,i=new Float32Array(2*n),s=n/(t+1);for(let e=0;e<n;e++)i[2*e]=e%t/t,i[2*e+1]=e/t/s;return i}(r.positions,t),l=function(e,t){const n=e.length,i=new Float32Array(t*n);for(let s=0;s<n;s++){const n=e[s];for(let e=0;e<t;e++)i[t*s+e]=n.level}return i}(e,t);return n.setAttribute("position",new i.TlE(r.positions,3)),n.setAttribute("center",new i.TlE(r.centers,3)),n.setAttribute("level",new i.TlE(l,1)),n.setAttribute("index",new i.TlE(a,1)),n.setAttribute("uv",new i.TlE(o,2)),n.computeFaceNormals(),n.computeVertexNormals(),{geom:n,vectors:s}}(e,20).geom}))),Z=new i.Tme;class H extends p{constructor(e){super(e),this.flows=[],this.time=0,this.instancedGroupMesh=null}onSelect(){const e=this.env,t=new i.Kj0($,V);e.reticle&&t.position.setFromMatrixPosition(e.reticle.matrix),this.shaderMaterial=t.material;const n=.001;t.scale.x=n,t.scale.y=-n,t.scale.z=n,O.branches.map((e=>e.slice(-1)[0])).forEach((e=>{if(!e.level)return;const i={level:e.level,x:t.position.x+e.x*n,y:t.position.y+-e.y*n,z:t.position.z+e.z*n,scale:.005};Z.position.set(i.x,i.y,i.z),Z.scale.set(i.scale,i.scale,i.scale),Z.rotateX(Math.PI/2),Z.updateMatrix(),i.matrix=Z.matrix.clone(),this.flows.push(i)})),e.scene.add(t);const s=c.heartMesh.scene.children[0];this.flows=this.flows.filter((()=>Math.random()>.8)),this.instancedGroupMesh=new i.SPe(s.geometry,new i.xoR({specular:"#ffffff",color:"#ff0000",emissive:"#333333",shininess:100}),this.flows.length),this.instancedGroupMesh.instanceMatrix.setUsage(i.dj0),e.scene.add(this.instancedGroupMesh)}animationLoop(){if(this.shaderMaterial&&(this.time++,this.shaderMaterial.uniforms.time.value=this.time),this.flows.length){let e=!1;this.flows.forEach(((t,n)=>{!t.visible&&function(e,t,n){const i=Math.max(0,Math.min(1,(n-0)/20));return i*i*(3-2*i)}(0,0,.5*this.time-t.level)>=1&&(t.visible=!0,this.instancedGroupMesh.setMatrixAt(n,t.matrix),e=!0)})),e&&(this.instancedGroupMesh.instanceMatrix.needsUpdate=!0)}}}class W extends p{mixed=[P,H,m,S,z];constructor(e){super(e),this.mixed=this.mixed.map((t=>new t(e)))}onSelect(){this.mixed.forEach((e=>e.onSelect()))}animationLoop(){this.mixed.forEach((e=>e.animationLoop()))}destroy(){this.mixed.forEach((e=>e.destroy())),this.mixed=null}}const X=new i.Tme,q=new i.ZAu;let Y=null;!async function(){await async function(){return Promise.all(Object.keys(c).map((e=>{let t=null;return"gltf"==c[e].type?t=d:"font"==c[e].type?t=h:"texture"==c[e].type&&(t=u),t.loadAsync(c[e].url).then((t=>{c[e]=t}))})))}(),Y=function(e,t){const n=new i.vBJ({color:26265,transparent:!0,opacity:1,side:i.ehD}),s={font:e,size:.1,height:.02},r=new i.MP$("点击播种",s);r.computeBoundingBox();const a=-.5*(r.boundingBox.max.x-r.boundingBox.min.x);return r.translate(a,0,0),new i.Kj0(r,n)}(c.fontMesh),q.add(c.reticleMesh.scene),Y.position.y+=.2,q.add(Y);let e=!1;const t=new a({reticleMesh:q,onSelect:()=>{e||(e=!0,t.reticleMesh.remove(Y),t.last_xyz=new i.Pa4(0,0,0),t.reticle&&(X.position.setFromMatrixPosition(t.reticle.matrix),t.last_xyz=X.position.clone()),n.onSelect())},animationLoop:()=>{n.animationLoop()}}),n=new W({env:t});t.xr||(t.scene.add(t.reticleMesh),t._onSelect())}()}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,n,s,r)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){for(var[n,s,r]=e[c],o=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(o=!1,r<a&&(a=r));o&&(e.splice(c--,1),t=s())}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,s,r]},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[a,o,l]=n,c=0;for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var d=l(i);for(t&&t(n);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[a[c]]=0;return i.O(d)},n=self.webpackChunkwebxr520=self.webpackChunkwebxr520||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[728],(()=>i(888)));s=i.O(s)})();